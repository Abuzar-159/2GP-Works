<template>
    <template if:true={isLoading}>
    <lightning-spinner alternative-text="Loading Payments"></lightning-spinner>
</template>
                    <section class="slds-card modern-card">
                        
                        <div class="slds-card__body slds-p-around_medium">
                           <div class="slds-grid slds-wrap slds-gutters payment-summary-row slds-m-bottom_large">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
                                   <div class="payment-summary-label">Search Orders</div>
                                <c-input-lookup
                                    obj-name="Order"
                                    search-placeholder="Search Orders..."
                                    icon-name="standard:orders"
                                    qry={orderFilter}
                                    selected-value={selectedOrderId}
                                    selected-name={selectedOrderName}
                                    selected-name-url={selectedOrderUrl}
                                    onlookupselected={handleOrderSelect}
                                    onremove={handleOrderRemove}
                                    is-value-selected={isOrderSelected}>
                                </c-input-lookup>
                            </div>
                            </div>


                            <!-- SUMMARY STRIP -->
                            <div class="slds-grid slds-wrap slds-gutters payment-summary-row slds-m-bottom_large">

                                <!-- ORDER AMOUNT — BLUE -->
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                                    <div class="payment-summary-tile payment-summary-tile--blue">
                                        <div class="payment-summary-icon-wrap">
                                            <lightning-icon icon-name="utility:orders" size="small"></lightning-icon>
                                        </div>
                                        <div class="payment-summary-text">
                                            <div class="payment-summary-label">Order Amount</div>
                                            <div class="payment-summary-value">
                                           <lightning-formatted-number
                                                format-style="currency"
                                                value={orderAmount}
                                                currency-code={orderCurrency}
                                                currency-display-as="symbol">
                                            </lightning-formatted-number>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- PAID — GREEN -->
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                                    <div class="payment-summary-tile payment-summary-tile--green">
                                        <div class="payment-summary-icon-wrap">
                                            <lightning-icon icon-name="utility:success" size="small"></lightning-icon>
                                        </div>
                                        <div class="payment-summary-text">
                                            <div class="payment-summary-label">Paid</div>
                                            <div class="payment-summary-value">
                                                <lightning-formatted-number
                                                format-style="currency"
                                                value={paidAmount}
                                                currency-code={orderCurrency}
                                                currency-display-as="symbol">
                                            </lightning-formatted-number>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <!-- TOTAL DUE — ORANGE -->
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                                    <div class="payment-summary-tile payment-summary-tile--warning">
                                        <div class="payment-summary-icon-wrap">
                                            <lightning-icon icon-name="utility:warning" size="small"></lightning-icon>
                                        </div>
                                        <div class="payment-summary-text">
                                            <div class="payment-summary-label">Total Due</div>
                                            <div class="payment-summary-value">£{dueAmount}</div>

                                        </div>
                                    </div>
                                </div>

                                <!-- CREDIT — LIGHT BLUE -->
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                                    <div class="payment-summary-tile payment-summary-tile--info">
                                        <div class="payment-summary-icon-wrap">
                                            <lightning-icon icon-name="utility:adjust_value" size="small"></lightning-icon>
                                        </div>
                                        <div class="payment-summary-text">
                                            <div class="payment-summary-label">Credit</div>
                                            <div class="payment-summary-value">
                                                        <lightning-formatted-number
                                                            format-style="currency"
                                                            value={creditAmount}
                                                            currency-code={orderCurrency}
                                                            currency-display-as="symbol">
                                                        </lightning-formatted-number>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- PAYMENT METHODS -->
                            <div class="slds-m-bottom_large">
                                <div class="slds-text-title_bold slds-m-bottom_small">Payment Methods</div>
                                <div class="slds-grid slds-gutters payment-methods-row">
                                    <div class="slds-col slds-size_1-of-3">
                                        <button type="button"
                                                class={cardMethodClass}
                                                data-method="card"
                                                onclick={handlePaymentMethodClick}>
                                            <lightning-icon icon-name="action:new_custom40" size="x-small"
                                                            class="payment-method-icon"></lightning-icon>
                                            <span>Credit/Debit Card</span>
                                        </button>
                                    </div>  
                                    <div class="slds-col slds-size_1-of-3">
                                        <button type="button"
                                                class={cashMethodClass}
                                                data-method="cash"
                                                onclick={handlePaymentMethodClick}>
                                            <lightning-icon icon-name="action:new_custom41" size="x-small"
                                                            class="payment-method-icon"></lightning-icon>
                                            <span>Cash</span>
                                        </button>
                                    </div>
                                    <div class="slds-col slds-size_1-of-3">
                                        <button type="button"
                                                class={bankMethodClass}
                                                data-method="bank"
                                                onclick={handlePaymentMethodClick}>
                                            <lightning-icon icon-name="action:new_custom87" size="x-small"
                                                            class="payment-method-icon"></lightning-icon>
                                            <span>Bank</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- ========= CARD PAYMENT AREA ========= -->
                           <template if:true={hasCardSection}>

                                <section class="slds-card modern-card slds-p-around_large">

                                    <!-- Card Payment Header -->
                                    <h2 class="slds-text-heading_small slds-m-bottom_large">
                                        <lightning-icon icon-name="custom:custom40" size="small"></lightning-icon>&nbsp;
                                        Card Payment</h2>

                                    <!-- Payment Gateway -->
                                    <div class="slds-grid slds-wrap slds-m-bottom_medium">
                                        <div class="slds-col slds-size_1-of-2">
                                            <div class="slds-form-element">
                                                <label class="slds-form-element__label">Payment Gateway</label>
                                                <div class="slds-form-element__control">
                                                   <lightning-combobox
                                                        value={selectedGateway}
                                                        placeholder="Select Payment Gateway..."
                                                        options={paymentGateway}
                                                        onchange={handlePaymentGateway}>
                                                    </lightning-combobox>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Invoice table -->
                                    <div class="slds-m-bottom_large">
                                        <table class="slds-table slds-table_bordered">
                                            <thead>
                                                <tr class="slds-text-title_caps">
                                                    <th scope="col"></th>
                                                    <th scope="col">Invoice Name</th>
                                                    <th scope="col">Type</th>
                                                    <th scope="col">Date</th>
                                                    <th scope="col">Total</th>
                                                    <th scope="col">Paid Amount</th>
                                                    <th scope="col">Due</th>
                                                    <th scope="col">Amount to pay</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <template for:each={invoiceToPay} for:item="inv" for:index="index">
                                                    <tr key={inv.trKey}>
                                                        <td>
                                                            <lightning-input type="checkbox"
                                                                data-index={index}
                                                                checked={inv.checked}
                                                                onchange={handlePayInvCheck}
                                                                disabled={inv.disableCheckbox}>
                                                            </lightning-input>
                                                        </td>

                                                        <td>
                                                            <a data-id={inv.Id} onclick={navigateRecord}>{inv.Name}</a>
                                                        </td>

                                                        <td>{inv.RecordType.DeveloperName}</td>
                                                        <td>{inv.Invoice_Date__c}</td>

                                                        <td>
                                                            <lightning-formatted-number
                                                                format-style="currency"
                                                                value={inv.Invoice_Amount__c}
                                                                currency-code={orderCurrency}>
                                                            </lightning-formatted-number>
                                                        </td>

                                                        <td>
                                                            <lightning-formatted-number
                                                                format-style="currency"
                                                                value={inv.Paid_Amount__c}
                                                                currency-code={orderCurrency}>
                                                            </lightning-formatted-number>
                                                        </td>

                                                        <td>
                                                            <lightning-formatted-number
                                                                format-style="currency"
                                                                value={inv.Total_Due__c}
                                                                currency-code={orderCurrency}>
                                                            </lightning-formatted-number>
                                                        </td>
                                                        <td>
                                                                <lightning-input
                                                                    type="number"
                                                                    formatter="currency"
                                                                    value={inv.AmountToPaid}
                                                                    step="0.01"
                                                                    data-index={index}
                                                                    onchange={handleInvDue}>
                                                                </lightning-input>
                                                            </td>


                                                        <td>
                                                            <template if:false={inv.isAdvance}>
                                                                <lightning-button-menu
                                                                    alternative-text="Show menu"
                                                                    onselect={handleMenuSelect}>
                                                                    
                                                                    <lightning-menu-item
                                                                        value={index}
                                                                        label={inv.postLable}>
                                                                    </lightning-menu-item>

                                                                </lightning-button-menu>
                                                            </template>
                                                        </td>


                                                    </tr>
                                                </template>


                                                <template if:true={hasInvoices}></template>

                                                <template if:false={hasInvoices}>
                                                    <tr>
                                                        <td colspan="5" style="text-align:center;">
                                                            No Invoices Found
                                                        </td>
                                                    </tr>
                                                </template>
                                            </tbody>

                                        </table>
                                    </div>

                                    <!-- Card details -->
                                   
                                    <div class="slds-m-bottom_large">
                                        <div class="slds-text-title_bold slds-m-bottom_small">Card Details</div>

                                        <div class="slds-grid slds-wrap slds-gutters">

                                            <!-- Card Holder Name -->
                                            <div class="slds-col slds-size_1-of-2">
                                                <lightning-input
                                                    label="Card Holder Name"
                                                    value={PaymentMethod.Name_on_Card__c}
                                                    onchange={handleCardName}
                                                    required>
                                                </lightning-input>
                                            </div>

                                            <!-- Card Type -->
                                            <div class="slds-col slds-size_1-of-2">
                                                <lightning-combobox
                                                    label="Card Type"
                                                    value={PaymentMethod.CardType__c}
                                                    options={CardTypes}
                                                    onchange={handleCardType}
                                                    placeholder="Select Card Type"
                                                    required>
                                                </lightning-combobox>
                                            </div>

                                            <!-- Expiry Month -->
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-combobox
                                                    label="Expiry Month"
                                                    value={PaymentMethod.Card_Expiration_Month__c}
                                                    options={ExpiryMonth}
                                                    onchange={handleCardExpMonth}
                                                    required>
                                                </lightning-combobox>
                                            </div>

                                            <!-- Expiry Year -->
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-combobox
                                                    label="Expiry Year"
                                                    value={PaymentMethod.Card_Expiration_Year__c}
                                                    options={ExpiryYear}
                                                    onchange={handleCardExpYear}
                                                    required>
                                                </lightning-combobox>
                                            </div>

                                            <!-- CVV -->
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input
                                                    label="CVV"
                                                    type="password"
                                                    value={CVV}
                                                    onchange={handleCVV}
                                                    maxlength="4"
                                                    required>
                                                </lightning-input>
                                            </div>

                                            <!-- Card Number -->
                                            <div class="slds-col slds-size_1-of-2">
                                                <lightning-input
                                                    label="Card Number"
                                                    type="password"
                                                    value={PaymentMethod.Card_Number__c}
                                                    onchange={handleCardNumber}
                                                    required>
                                                </lightning-input>
                                            </div>

                                            <!-- Reference No -->
                                            <div class="slds-col slds-size_1-of-2">
                                                <lightning-input
                                                    label="Reference No"
                                                    value={paymentToUpsert.Reference_Cheque_No__c}
                                                    onchange={handleRefCheque}>
                                                </lightning-input>
                                            </div>

                                            <!-- Payment Amount -->
                                            <div class="slds-col slds-size_1-of-2">

                                                <div class="slds-form-element">
                                        <label class="slds-form-element__label">Payment Amount</label>

                                        <div class="slds-form-element__control">
                                            <lightning-formatted-number
                                                value={computedPaymentAmount}
                                                format-style="currency"
                                                currency-code={orderCurrency}>
                                            </lightning-formatted-number>
                                        </div>
                                    </div>
                                                
                                            </div>

                                        </div>
                                    </div>

                                    <!-- Billing Address -->
                                    <div class="slds-m-bottom_large">
                                        <div class="slds-text-title_bold slds-m-bottom_small">Billing Address</div>

                                        <div class="slds-grid slds-wrap slds-gutters">
                                            <div class="slds-col slds-size_1-of-2">
                                               <lightning-input label="Address" value={paymentBillAdd.Name} oncommit={handleBillLine} disabled ></lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <lightning-input label="Address Line1" value={paymentBillAdd.Address_Line1__c} oncommit={handleBillLine1} disabled></lightning-input>
                                            </div>

                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input label="City" value={paymentBillAdd.City__c} oncommit={handleBillCity} disabled></lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input label="Country" value={paymentBillAdd.Country__c} onchange={handleBillCountry} disabled></lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_1-of-3">
                                                <lightning-input label="State/Province" value={paymentBillAdd.State__c} onchange={handleBillState} disabled></lightning-input>
                                            </div>

                                            <div class="slds-col slds-size_1-of-3">
                                               <lightning-input label="Zip/Postal Code" value={paymentBillAdd.Postal_Code__c} oncommit={handleBillZip} disabled></lightning-input>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Footer buttons -->
                                    <div class="slds-text-align_center slds-m-top_medium">
                                        <lightning-button label="Pay Now" variant="brand" onclick={cardPaymentSave}></lightning-button>
                                    </div>
                                </section>
                            </template>

                            <!-- ========= CASH PAYMENT ========= -->
                            <template if:true={isCashMethod}>
                                <section class="slds-card modern-card slds-p-around_large slds-m-top_large">

                                    <!-- Title -->
                                    <h2 class="slds-text-heading_small slds-m-bottom_large">
                                        <lightning-icon icon-name="custom:custom41" size="small"></lightning-icon>&nbsp;
                                        Cash Payment</h2>

                                    <!-- Error Message -->
                                    <template if:true={paymentError}>
                                        <div class="slds-text-color_error slds-m-bottom_small">
                                            * <lightning-formatted-text value={paymentError}></lightning-formatted-text>
                                        </div>
                                    </template>

                                    <!-- INVOICE TABLE -->
                                    <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                        <thead>
                                            <tr class="slds-text-title_caps">
                                                <th></th>
                                                <th>Invoice Name</th>
                                                <th>Type</th>
                                                <th>Posted</th>
                                                <th>Date</th>
                                                <th>Total</th>
                                                <th>Paid</th>
                                                <th>Due</th>
                                                <th>Amount To Pay</th>
                                                <th></th>
                                                
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <template if:true={invoiceToPay}>
                                                <template for:each={invoiceToPay} for:item="inv" for:index="index">
                                                    <tr key={inv.trKey}>
                                                        <!-- CHECKBOX -->
                                                        <td>
                                                            <lightning-input type="checkbox"
                                                                            data-index={index}
                                                                            checked={inv.checked}
                                                                            onchange={handlePayInvCheck}
                                                                            disabled={inv.disableCheckbox}>
                                                            </lightning-input>
                                                        </td>

                                                        <!-- Invoice Link -->
                                                        <td>
                                                            <a data-id={inv.Id} onclick={navigateRecord}>{inv.Name}</a>
                                                        </td>

                                                        <td>{inv.RecordType.DeveloperName}</td>

                                                        <!-- Posted YES/NO -->
                                                        <td>
                                                            <div class={inv.isPostedClass}>{inv.isPosted}</div>
                                                        </td>

                                                        <td>{inv.Invoice_Date__c}</td>

                                                        <td>
                                                            <lightning-formatted-number value={inv.Invoice_Amount__c}
                                                                                        format-style="currency"
                                                                                        currency-code={orderCurrency}>
                                                            </lightning-formatted-number>
                                                        </td>

                                                        <td>
                                                            <lightning-formatted-number value={inv.Paid_Amount__c}
                                                                                        format-style="currency"
                                                                                        currency-code={orderCurrency}>
                                                            </lightning-formatted-number>
                                                        </td>

                                                        <td>
                                                            <lightning-formatted-number value={inv.Total_Due__c}
                                                                                        format-style="currency"
                                                                                        currency-code={orderCurrency}>
                                                            </lightning-formatted-number>
                                                        </td>

                                                        <!-- Amount to Pay (editable) -->
                                                        <td>
                                                            <lightning-input type="number"
                                                                            value={inv.AmountToPaid}
                                                                            step="0.01"
                                                                            data-index={index}
                                                                            onchange={handleInvDue}>
                                                            </lightning-input>
                                                        </td>

                                                        <!-- Post/Unpost Menu -->
                                                        <td>
                                                           
                                                                <template if:false={inv.isAdvance}>
                                                                    <lightning-button-menu onselect={handleMenuSelect}>
                                                                        <lightning-menu-item value={index} label={inv.postLable}></lightning-menu-item>
                                                                    </lightning-button-menu>
                                                                </template>
                                                            

                                                        </td>
                                                    </tr>
                                                </template>
                                            </template>

                                            <template if:false={hasInvoices}>
                                                <tr>
                                                    <td colspan="10" style="text-align:center;">
                                                        No Due Invoices Found
                                                    </td>
                                                </tr>
                                            </template>

                                        </tbody>
                                    </table>

                                    <!-- CASH PAYMENT INPUTS -->
                                    <div class="slds-grid slds-wrap slds-m-top_large">

                                        <!-- Reference No -->
                                        <div class="slds-col slds-size_1-of-2 slds-p-right_large">
                                            <lightning-input
                                                label="Reference No."
                                                value={paymentToUpsert.Reference_Cheque_No__c}
                                                onchange={handleRefCheque}
                                                required>
                                            </lightning-input>
                                        </div>

                                        <!-- Total Payment Amount -->
                                        <div class="slds-col slds-size_1-of-2">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Payment Amount</label>

                                        <div class="slds-form-element__control">
                                            <lightning-formatted-number
                                                value={computedPaymentAmount}
                                                format-style="currency"
                                                currency-code={orderCurrency}>
                                            </lightning-formatted-number>
                                        </div>
                                    </div>
                                </div>


                                    </div>

                                    <!-- Footer -->
                                    <div class="slds-text-align_center slds-m-top_large">
                                        <lightning-button label="Cancel" class="slds-m-right_small"></lightning-button>
                                        <lightning-button label="Save" variant="brand" onclick={cashPaymentSave}></lightning-button>
                                    </div>

                                </section>
                            </template>

                            <!-- ========= BANK PAYMENT ========= -->
                            <template if:true={isBankMethod}>
    <section class="slds-card modern-card slds-p-around_large slds-m-top_large">

        <!-- Title -->
        <h2 class="slds-text-heading_small slds-m-bottom_large">
        <lightning-icon icon-name="custom:custom24" size="small"></lightning-icon>&nbsp;
        Bank Payment
        </h2>

        <!-- Error Message -->
        <template if:true={paymentError}>
            <div class="slds-text-color_error slds-m-bottom_small">
                * <lightning-formatted-text value={paymentError}></lightning-formatted-text>
            </div>
        </template>

        <!-- INVOICE TABLE -->
        <table class="slds-table slds-table_cell-buffer slds-table_bordered">
            <thead>
                <tr class="slds-text-title_caps">
                    <th></th>
                    <th>Invoice Name</th>
                    <th>Type</th>
                    <th>Posted</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Paid</th>
                    <th>Due</th>
                    <th>Amount To Pay</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                <template if:true={invoiceToPay}>
                    <template for:each={invoiceToPay} for:item="inv" for:index="index">
                        <tr key={inv.trKey}>
                            <td>
                                <lightning-input type="checkbox"
                                                 data-index={index}
                                                 checked={inv.checked}
                                                 onchange={handlePayInvCheck}
                                                 disabled={inv.disableCheckbox}>
                                </lightning-input>
                            </td>

                            <td><a onclick={navigateRecord} data-id={inv.Id}>{inv.Name}</a></td>
                            <td>{inv.RecordType.DeveloperName}</td>

                            <td><div class={inv.isPostedClass}>{inv.isPosted}</div></td>
                            <td>{inv.Invoice_Date__c}</td>

                            <td>
                                <lightning-formatted-number value={inv.Invoice_Amount__c}
                                                            format-style="currency"
                                                            currency-code={orderCurrency}>
                                </lightning-formatted-number>
                            </td>

                            <td>
                                <lightning-formatted-number value={inv.Paid_Amount__c}
                                                            format-style="currency"
                                                            currency-code={orderCurrency}>
                                </lightning-formatted-number>
                            </td>

                            <td>
                                <lightning-formatted-number value={inv.Total_Due__c}
                                                            format-style="currency"
                                                            currency-code={orderCurrency}>
                                </lightning-formatted-number>
                            </td>

                            <!-- Amount To Pay -->
                            <td>
                                <lightning-input type="number"
                                                 value={inv.AmountToPaid}
                                                 data-index={index}
                                                 step="0.01"
                                                 onchange={handleInvDue}>
                                </lightning-input>
                            </td>

                            <td>
                                <template if:false={inv.isAdvance}>
                                    <lightning-button-menu>
                                        <lightning-menu-item label={inv.postLable}
                                                             data-index={index}>
                                        </lightning-menu-item>
                                    </lightning-button-menu>
                                </template>
                            </td>
                        </tr>
                    </template>
                </template>

                <template if:false={hasInvoices}>
                    <tr><td colspan="10" class="slds-text-align_center">No Due Invoices Found</td></tr>
                </template>
            </tbody>
        </table>

        <!-- BANK DETAILS FORM -->
        <div class="slds-grid slds-wrap slds-gutters slds-m-top_large">

            <!-- Bank Name -->
            <div class="slds-col slds-size_1-of-4">
                <lightning-input
                    label="Bank"
                    value={paymentToUpsert.Bank__c}
                    onchange={handleBankName}>
                </lightning-input>
            </div>

            <!-- Account Holder -->
            <div class="slds-col slds-size_1-of-4">
                <lightning-input
                    label="Account Holder Name"
                    value={paymentToUpsert.Account_Holder_Name__c}
                    onchange={handleAHName}>
                </lightning-input>
            </div>

            <!-- Bank Account (COA Lookup) -->
            <div class="slds-col slds-size_1-of-4">
                <label  class="slds-form-element__label slds-no-flex" >
                    Bank Account
                </label>
                <c-custom-input-lookup-l-w-c
                    label="Bank Account"
                    obj-name="Chart_of_Accounts__c"
                    selected-value={paymentToUpsert.Payment_Account__c}
                    onlookupselected={selectCOA}
                    onremove={removeCOA}
                    search-placeholder="Search..."
                    icon-name="custom:custom16">
                </c-custom-input-lookup-l-w-c>
            </div>

            <!-- Account Type -->
            <div class="slds-col slds-size_1-of-4">
                <lightning-combobox
                    label="Account Type"
                    value={paymentToUpsert.Account_Type__c}
                    options={accountTypeOptions}
                    onchange={handleACtype}>
                </lightning-combobox>
            </div>

            <!-- Account Number -->
            <div class="slds-col slds-size_1-of-4 slds-m-top_medium">
                <lightning-input
                    label="Account Number"
                    value={paymentToUpsert.Account_Number__c}
                    onchange={handleACNumber}>
                </lightning-input>
            </div>

            <!-- Bank Code -->
            <div class="slds-col slds-size_1-of-4 slds-m-top_medium">
                <lightning-input
                    label="Bank Code"
                    value={paymentToUpsert.Bank_Code__c}
                    onchange={handleBankCode}>
                </lightning-input>
            </div>

            <!-- Reference Number -->
            <div class="slds-col slds-size_1-of-4 slds-m-top_medium">
                <lightning-input
                    label="Reference/Cheque No."
                    value={paymentToUpsert.Reference_Cheque_No__c}
                    onchange={handleBankRefCheque}
                    required>
                </lightning-input>
            </div>

            <!-- Payment Amount -->
            <div class="slds-col slds-size_1-of-4 slds-m-top_medium">
                <div class="slds-form-element">
                    <label class="slds-form-element__label">
                        Payment Amount
                    </label>

                    <div class="slds-form-element__control">
                        <lightning-formatted-number
                            value={computedPaymentAmount}
                            format-style="currency"
                            currency-code={orderCurrency}>
                        </lightning-formatted-number>
                    </div>
                </div>
            </div>


        </div>

        <!-- Footer -->
        <div class="slds-text-align_center slds-m-top_x-large">
            <lightning-button label="Save" variant="brand" onclick={bankPaymentSave}></lightning-button>
        </div>

    </section>
                            </template>


                        </div>
                    </section>
                </template>